# P1 + P2 å…¨éƒ¨ä»»åŠ¡å®Œæˆæµ‹è¯•æ€»ç»“

> **æ—¥æœŸ**: 2026-02-06  
> **æ‰§è¡Œç¯å¢ƒ**: macOS, Python 3.12.10, pytest 8.4.1

---

## ä¸€ã€P1 ä»»åŠ¡å®Œæˆæƒ…å†µ

### T2 [P1]: ä¿®å¤æŒ‡æ ‡è¾¹ç•Œæ¡ä»¶ âœ…

**é—®é¢˜**: `calculate_detailed_metrics("", "abc")` è¿”å› `cer=3.0, accuracy=-2.0`  
**åŸå› **: `ref_chars = [""]` å¯¼è‡´ `ref_length=1`ï¼Œç¼–è¾‘è·ç¦» = 3 â†’ CER = 3/1 = 3.0  
**ä¿®å¤**: åœ¨ `metrics.py` ä¸­æ·»åŠ æ˜¾å¼è¾¹ç•Œæ¡ä»¶å¤„ç†ï¼Œç»Ÿä¸€ä¸ `calculate_cer()` è¯­ä¹‰

**éªŒè¯ç»“æœ**:

| è¾“å…¥ (ref, hyp) | ä¿®å¤å‰ CER | ä¿®å¤å CER | ä¿®å¤å accuracy | çŠ¶æ€ |
|------------------|-----------|-----------|----------------|------|
| `("", "")` | ä¸ç¡®å®š | 0.0 | 1.0 | âœ… |
| `("", "abc")` | 3.0 | 1.0 | 0.0 | âœ… |
| `("abc", "")` | ä¸ç¡®å®š | 1.0 | 0.0 | âœ… |
| `("ï¼Œã€‚ï¼", "æœ‰å†…å®¹")` | ä¸ç¡®å®š | 1.0 | 0.0 | âœ… |
| `("ä»Šå¤©å¤©æ°”å¾ˆå¥½", "ä»Šå¤©å¤©æ°”å¾ˆå¥½")` | 0.0 | 0.0 | 1.0 | âœ… |
| ä¸€è‡´æ€§: `calculate_cer` vs `detailed` | ä¸ä¸€è‡´ | ä¸€è‡´ | ä¸€è‡´ | âœ… |

---

### T3 [P1]: ä¿®å¤ CLI é€€å‡ºç  âœ…

**é—®é¢˜**: CLI å¤±è´¥æ—¶ä»è¿”å›é€€å‡ºç  0  
**ä¿®å¤**: 
- å•æ–‡ä»¶æ¨¡å¼ `result is None` æ—¶è¿”å› 1
- æ‰¹å¤„ç†æ¨¡å¼ `not results` æ—¶è¿”å› 1
- `verbose` å‚æ•°ä¼ é€’ä¿®æ­£ï¼ˆä¸å†ç¡¬ç¼–ç  Trueï¼‰
- é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ° stderr

**éªŒè¯**: `cer-tool --asr /nonexist --ref /nonexist` â†’ é€€å‡ºç  **1** âœ…

---

### T4 [P1]: ä¿®å¤ run_tests.py âœ…

**é—®é¢˜**: 
1. ç¡¬ç¼–ç  `python`ï¼ˆå½“å‰ç¯å¢ƒæ—  pytestï¼‰
2. ä» `tests/` å†…å†ä¼  `tests/` å¯¼è‡´è·¯å¾„åµŒå¥—
3. `--cov=src` ä¸å®é™… `dev/src` ä¸ä¸€è‡´

**ä¿®å¤**: 
- `sys.executable` æ›¿ä»£ç¡¬ç¼–ç  `python`
- `get_project_root()` åŠ¨æ€è·å–é¡¹ç›®æ ¹ç›®å½•
- `--cov` è·¯å¾„ä¿®æ­£ä¸º `dev/src`
- æ–°å¢ `check`/`coverage`/`help` å‘½ä»¤

**éªŒè¯**: `python3 tests/run_tests.py basic` â†’ 10 passed âœ…

---

### T5 [P1]: é›†æˆé¢„å¤„ç†æµæ°´çº¿ âœ…

**é—®é¢˜**: `preprocess_text()` ç¡¬ä¾èµ– `jiwer.Compose()`  
**ä¿®å¤**: ç”¨è‡ªç ” `PreprocessingPipeline` æ›¿ä»£ï¼Œé€šè¿‡ `_build_pipeline()` æ„å»º

**éªŒè¯**: æ›¿æ¢åå…¨éƒ¨ 14 ä¸ªæµ‹è¯•é€šè¿‡ï¼ŒCER è®¡ç®—ç»“æœä¸å˜ âœ…

---

### T5b [P1]: ç›®å½•é‡ç»„ + åŒ…åŒ– âœ…

**æ“ä½œ**:
1. `dev/src/` â†’ `dev/v1.0-archive/`ï¼ˆå°å­˜ï¼‰
2. åˆ›å»º `src/cer_tool/` Python åŒ…
3. æ–‡ä»¶é‡å‘½åæ˜ å°„ï¼š
   - `asr_metrics_refactored.py` â†’ `metrics.py`
   - `main_with_tokenizers.py` â†’ `gui.py`
   - `preprocessing_pipeline.py` â†’ `preprocessing.py`
   - `text_tokenizers/` â†’ `tokenizers/`ï¼ˆæ‰å¹³åŒ–ï¼‰
4. æ‰€æœ‰å¯¼å…¥è·¯å¾„æ›´æ–°ä¸º `from cer_tool.xxx import xxx`
5. åˆ›å»º `__init__.py`ï¼ˆç‰ˆæœ¬å…ƒæ•°æ®ï¼‰å’Œ `__main__.py`ï¼ˆå…¥å£ç‚¹ï¼‰

**éªŒè¯**: `pytest -v` â†’ 14 passed âœ…

---

## äºŒã€P2 ä»»åŠ¡å®Œæˆæƒ…å†µ

### T6 [P2]: ç§»é™¤ jiwer ä¾èµ– âœ…

**æ“ä½œ**: T5 å·²æ›¿æ¢ metrics.py ä¸­çš„ jiwer è°ƒç”¨ï¼ŒT6 ç§»é™¤ gui.py ä¸­çš„æ­»å¯¼å…¥ `import jiwer`  
**éªŒè¯**: `grep "import jiwer" src/cer_tool/` â†’ æ— åŒ¹é… âœ…

---

### T7 [P2]: ç§»é™¤ pandas ä¾èµ– âœ…

**æ“ä½œ**: gui.py çš„ CSV å¯¼å‡ºä» `pd.DataFrame.to_csv()` æ”¹ä¸º `csv.DictWriter`  
**éªŒè¯**: `grep "import pandas" src/cer_tool/` â†’ æ— åŒ¹é… âœ…

---

### T8 [P2]: ç»Ÿä¸€ä¾èµ–åˆ†å±‚ âœ…

**æ“ä½œ**:
1. åˆ›å»º `pyproject.toml`ï¼šæ ¸å¿ƒä»… `jieba`ï¼Œå¯é€‰é€šè¿‡ extras å®‰è£…
2. æ›´æ–° `requirements.txt`ï¼šç§»é™¤ jiwerã€pandas
3. æ›´æ–° `Pipfile`ï¼šå¯é€‰åˆ†è¯å™¨ç§»åˆ° `[dev-packages]`

**æ ¸å¿ƒä¾èµ–å¯¹æ¯”**:

| ä¾èµ– | V1 | V2 |
|------|-----|-----|
| jieba | âœ… å¿…éœ€ | âœ… å¿…éœ€ |
| jiwer | âœ… å¿…éœ€ | âŒ ç§»é™¤ |
| pandas | âœ… å¿…éœ€ | âŒ ç§»é™¤ |
| python-Levenshtein | âœ… å¿…éœ€ | âš¡ æ¨èï¼ˆå†…ç½®å¤‡é€‰ï¼‰ |
| thulac | âš ï¸ Pipfile å¿…è£… | ğŸ“¦ extras `[thulac]` |
| hanlp + torch | âš ï¸ Pipfile å¿…è£… | ğŸ“¦ extras `[hanlp]` |

---

### T9 [P2]: æå–å…¬å…±æ¨¡å— âœ…

**æ“ä½œ**: åˆ›å»º `src/cer_tool/file_utils.py`ï¼Œä» CLI å’Œ GUI ä¸­æå– `read_file_with_encodings()`  
**éªŒè¯**: CLI å’Œ GUI éƒ½å§”æ‰˜åˆ°å…¬å…±æ¨¡å— âœ…

---

### T10 [P2]: CLI å¢å¼º âœ…

**æ–°å¢åŠŸèƒ½**:
- `--version`ï¼šè¾“å‡º `CER-Analysis-Tool 2.0.0`
- `--format json`ï¼šJSON è¾“å‡ºï¼ˆstdout æˆ–æ–‡ä»¶ï¼‰
- `save_results_to_json()`ï¼šå¸¦ summary çš„ JSON ç»“æ„
- `--format` å‚æ•°ï¼šæ”¯æŒ text/csv/json
- é”™è¯¯è¾“å‡ºåˆ° stderr

**éªŒè¯**: `cer-tool --version` â†’ `CER-Analysis-Tool 2.0.0` âœ…

---

### T11 [P2]: ä¿®æ­£æ¶æ„æ–‡æ¡£ âœ…

**æ“ä½œ**: åˆ›å»º `docs/CER-Analysis-Tool-V2-æ¶æ„å˜æ›´è¯´æ˜.md`  
**å†…å®¹**: 
- é¡¹ç›®æ›´åæ˜ å°„
- V1 â†’ V2 ç›®å½•ç»“æ„å¯¹ç…§
- ä¾èµ–å˜æ›´è¡¨
- é¢„å¤„ç†æ¶æ„å˜æ›´ï¼ˆjiwer â†’ Pipelineï¼‰
- è¾¹ç•Œè¯­ä¹‰ä¿®æ­£
- CLI å¢å¼ºåˆ—è¡¨
- V1 æ¶æ„æ–‡æ¡£ä¸­æœªå®ç°ç»„ä»¶çš„æ¾„æ¸…

---

## ä¸‰ã€æµ‹è¯•æ€»ç»“

### pytest å…¨é‡è¿è¡Œ

```
======================== 14 passed, 1 warning in 7.27s =========================
```

### è¦†ç›–çš„æµ‹è¯•ç±»åˆ«

| æ ‡è®° | æµ‹è¯•æ•° | çŠ¶æ€ |
|------|--------|------|
| basic | 10 | âœ… |
| unit | 2 | âœ… |
| integration | 1 | âœ… |
| optional | 2 | âœ… |

### éªŒè¯æ¸…å•

- [x] pytest æ”¶é›†æ— æŠ¥é”™
- [x] 14/14 æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [x] è¾¹ç•Œæ¡ä»¶ 6 ç»„å…¨éƒ¨æ­£ç¡®
- [x] CLI é€€å‡ºç æ­£ç¡®
- [x] `--version` æ­£ç¡®
- [x] run_tests.py å¯ç”¨
- [x] jiwer/pandas é›¶å¯¼å…¥
- [x] æ–°ç›®å½•ç»“æ„å®Œæ•´ï¼ˆ11 ä¸ª .py æ–‡ä»¶ï¼‰
- [x] pyproject.toml é…ç½®æ­£ç¡®
- [x] æ¶æ„æ–‡æ¡£å·²æ›´æ–°

---

## å››ã€å˜æ›´æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `src/cer_tool/__init__.py` | åŒ…å…ƒæ•°æ® |
| `src/cer_tool/__main__.py` | å…¥å£ç‚¹ |
| `src/cer_tool/metrics.py` | æŒ‡æ ‡å¼•æ“ï¼ˆä¿®å¤è¾¹ç•Œ + Pipelineï¼‰ |
| `src/cer_tool/cli.py` | CLIï¼ˆé€€å‡ºç  + JSON + --versionï¼‰ |
| `src/cer_tool/gui.py` | GUIï¼ˆç§»é™¤ jiwer/pandasï¼‰ |
| `src/cer_tool/preprocessing.py` | é¢„å¤„ç†æµæ°´çº¿ |
| `src/cer_tool/file_utils.py` | å…¬å…±æ–‡ä»¶å·¥å…· |
| `src/cer_tool/tokenizers/` | åˆ†è¯å™¨åŒ…ï¼ˆæ‰å¹³åŒ–ï¼‰ |
| `pyproject.toml` | é¡¹ç›®é…ç½® |
| `dev/v1.0-archive/` | V1 æºç å°å­˜ |
| `docs/CER-Analysis-Tool-V2-æ¶æ„å˜æ›´è¯´æ˜.md` | æ¶æ„å˜æ›´è¯´æ˜ |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ |
|------|------|
| `requirements.txt` | ç§»é™¤ jiwer/pandas |
| `Pipfile` | å¯é€‰åˆ†è¯å™¨ç§»åˆ° dev |
| `tests/run_tests.py` | sys.executable + è·¯å¾„ä¿®æ­£ |
| `tests/test_*.py` (3ä¸ª) | å¯¼å…¥è·¯å¾„ â†’ cer_tool |

### åˆ é™¤æ–‡ä»¶/ç›®å½•

| è·¯å¾„ | è¯´æ˜ |
|------|------|
| `dev/src/` | åŸå§‹æºç ç›®å½•ï¼ˆå·²å°å­˜åˆ° v1.0-archiveï¼‰ |
