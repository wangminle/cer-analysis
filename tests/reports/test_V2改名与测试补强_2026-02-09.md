# 测试总结：V2 项目改名 + 测试体系补强

## 基本信息

| 项目 | 内容 |
|------|------|
| **测试日期** | 2026-02-09 |
| **测试环境** | macOS, Python 3.12.10, pytest 8.4.1 |
| **测试范围** | 项目改名（N1）+ 测试体系补强（N2-N6） |
| **测试结果** | **129/129 全部通过** ✅ |

---

## 一、N1：项目改名落地

### 变更内容

| 文件 | 改动点 |
|------|--------|
| `src/cer_tool/gui.py` | 类名 `ASRComparisonTool` → `CERAnalysisTool`，窗口标题改为 `CER Analysis Tool - 多分词器版本`，作者注释 → `CER-Analysis-Tool 项目组`，版本标注 → V2.0 |
| `src/cer_tool/__main__.py` | 导入和实例化改为 `CERAnalysisTool` |
| `src/cer_tool/__init__.py` | 添加 `__getattr__` 兼容性包装（`ASRComparisonTool` → `CERAnalysisTool`，带 `DeprecationWarning`） |
| `src/cer_tool/metrics.py` | 文档注释更新为 `CER Analysis Tool` |
| `.cursorrules` | 目录约定更新（`/dev/src` → `/src/cer_tool/`），文档前缀更新（`Cer-MatchingTools-V1-` → `CER-Analysis-Tool-V2-`），依赖信息修正 |
| `pyproject.toml` | `build-backend` 修正为 `setuptools.build_meta`（修复 `pip install -e .` 安装失败） |

### 兼容性验证

```
$ python3 -W all -c "from cer_tool import ASRComparisonTool"
DeprecationWarning: ASRComparisonTool 已更名为 CERAnalysisTool，
请使用 from cer_tool.gui import CERAnalysisTool。旧名称将在 V2.1.0 中移除。
```

旧名称仍可使用，但会发出弃用警告。✅

---

## 二、N2-N6：测试体系补强

### 新增测试文件汇总

| 文件 | 用例数 | 标记 | 覆盖范围 |
|------|--------|------|----------|
| `test_boundary.py` | 20 | `basic`, `boundary` | 空文本、仅标点、完全匹配/不匹配、超长文本、特殊字符、一致性验证 |
| `test_cli.py` | 14 | `basic`, `cli` | --version、--list-tokenizers、单文件模式、批处理模式、JSON/CSV 输出、退出码、stderr |
| `test_preprocessing.py` | 25 | `basic`, `pipeline` | 8 个独立步骤、流水线组装/管理、5 个预设模板、边界条件 |
| `test_core_metrics.py` | 33 | `basic`, `unit` | 编辑操作回溯、CER 参数化、WER/accuracy、文本标准化、详细指标、差异展示、内置编辑距离 |
| `test_tokenizers_unit.py` | 23 | `basic`, `unit`, `optional` | 可用性检测、工厂方法与单例、信息获取、jieba 核心功能、基类接口、可选分词器 |

### 测试规模对比

| 指标 | 改动前 | 改动后 | 增长 |
|------|--------|--------|------|
| 测试文件数 | 3 个 | 8 个 | +5 |
| 测试用例数 | 14 个 | 129 个 | +115 (×9.2) |
| 边界条件覆盖 | 0 | 20 个 | +20 |
| CLI 测试覆盖 | 0 | 14 个 | +14 |
| 预处理测试覆盖 | 0 | 25 个 | +25 |
| 分词器测试覆盖 | 0 | 23 个 | +23 |

---

## 三、全量测试结果

```
$ python3 -m pytest -v
======================== 129 passed, 1 warning in 35.24s =======================
```

### 按标记分类

| 标记 | 说明 | 状态 |
|------|------|------|
| `basic` | 基础测试（仅依赖 jieba） | ✅ 全部通过 |
| `boundary` | 边界条件测试 | ✅ 全部通过 |
| `cli` | CLI 工具测试 | ✅ 全部通过 |
| `pipeline` | 预处理流水线测试 | ✅ 全部通过 |
| `unit` | 单元测试 | ✅ 全部通过 |
| `optional` | 可选分词器测试 | ✅ 全部通过（thulac/hanlp 均已安装） |

### 已知警告

| 警告 | 来源 | 影响 |
|------|------|------|
| `pkg_resources is deprecated` | jieba 库内部使用 | 非本项目问题，等待 jieba 更新 |

---

## 四、本次改动文件清单

### 修改的源码文件

| 文件 | 变更内容 |
|------|----------|
| `src/cer_tool/gui.py` | 类名/标题/注释改名 |
| `src/cer_tool/__main__.py` | 导入改名 |
| `src/cer_tool/__init__.py` | 添加兼容性包装 |
| `src/cer_tool/metrics.py` | 文档注释更新 |
| `.cursorrules` | 目录约定和前缀更新 |
| `pyproject.toml` | build-backend 修正 |

### 新增的测试文件

| 文件 | 用例数 |
|------|--------|
| `tests/test_boundary.py` | 20 |
| `tests/test_cli.py` | 14 |
| `tests/test_preprocessing.py` | 25 |
| `tests/test_core_metrics.py` | 33 |
| `tests/test_tokenizers_unit.py` | 23 |

---

## 五、结论

**全部任务完成。** 项目改名已落地到代码中，测试用例从 14 个扩充到 129 个，覆盖了边界条件、CLI、预处理流水线、核心指标计算和分词器五大领域，129/129 全部通过。
